# æ•°æ®æ¸…æ´—ç¬”è®°æœ¬ - åˆ›å»ºå®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

æ ¹æ® [glue_scripts/1_data_cleansing.py](glue_scripts/1_data_cleansing.py) æˆåŠŸåˆ›å»ºäº†ä¸¤ä¸ªå®Œæ•´çš„æ•°æ®æ¸…æ´—ç¬”è®°æœ¬ï¼

---

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

### Jupyter ç¬”è®°æœ¬ (2 ä¸ª)

| æ–‡ä»¶ | è·¯å¾„ | ç”¨é€” | æ¨èåº¦ |
|------|------|------|--------|
| **test_pandas_cleansing.ipynb** | [test/pandas/](test/pandas/test_pandas_cleansing.ipynb) | æœ¬åœ°æ•°æ®æ¸…æ´— (æ¨è) | â­â­â­ |
| **test_spark_cleansing.ipynb** | [test/spark/](test/spark/test_spark_cleansing.ipynb) | Sparkåˆ†å¸ƒå¼å¤„ç† | â­â­ |

### æ–‡æ¡£ (1 ä¸ª)

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| [test/NOTEBOOKS_GUIDE.md](test/NOTEBOOKS_GUIDE.md) | ç¬”è®°æœ¬ä½¿ç”¨æŒ‡å— |

---

## ğŸ¯ ä¸¤ä¸ªç¬”è®°æœ¬çš„å¯¹æ¯”

### Pandas ç‰ˆæœ¬ â­â­â­

**ä¼˜ç‚¹**:
- âœ“ æ— éœ€ Java ä¾èµ–
- âœ“ å¯åŠ¨å¿« (< 1ç§’)
- âœ“ ä»£ç æ˜“è¯»
- âœ“ åŒ…å«æ•°æ®å¯è§†åŒ–
- âœ“ å®Œå…¨å…¼å®¹ Windows

**é€‚ç”¨åœºæ™¯**:
- å¼€å‘å’Œæµ‹è¯•
- æ•°æ®åˆ†æ
- å•æœºå¤„ç† (< 100GB)

**å¿«é€Ÿå¼€å§‹**:
```bash
jupyter notebook test/pandas/test_pandas_cleansing.ipynb
```

---

### Spark ç‰ˆæœ¬ â­â­

**ä¼˜ç‚¹**:
- âœ“ åˆ†å¸ƒå¼å¤„ç†
- âœ“ å¤§æ•°æ®æ”¯æŒ (> 100GB)
- âœ“ ç”Ÿäº§çº§æ€§èƒ½
- âœ“ ä¸ AWS Glue å…¼å®¹

**é€‚ç”¨åœºæ™¯**:
- ç”Ÿäº§ç¯å¢ƒ
- å¤§æ•°æ®å¤„ç†
- åˆ†å¸ƒå¼è®¡ç®—

**å¿«é€Ÿå¼€å§‹**:
```bash
set JAVA_HOME=C:\Program Files\Java\jdk-11
jupyter notebook test/spark/test_spark_cleansing.ipynb
```

---

## ğŸ“Š ç¬”è®°æœ¬åŠŸèƒ½æ¸…å•

ä¸¤ä¸ªç¬”è®°æœ¬éƒ½åŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

### ç¯å¢ƒé…ç½®
- [x] Python/Pandas/Spark ç¯å¢ƒåˆå§‹åŒ–
- [x] Windows ç¼–ç é—®é¢˜ä¿®å¤
- [x] Java é…ç½® (Spark ç‰ˆæœ¬)

### æ•°æ®åŠ è½½
- [x] è¯»å– CSV æ–‡ä»¶
- [x] è‡ªåŠ¨æ£€æµ‹é¡¹ç›®è·¯å¾„
- [x] æ˜¾ç¤ºæ•°æ®åŸºæœ¬ä¿¡æ¯

### å®¢æˆ·åŸºæœ¬ä¿¡æ¯æ¸…æ´—
- [x] æ•°æ®ç±»å‹è½¬æ¢ (å­—ç¬¦ä¸²ã€æ•°å€¼ã€æ—¥æœŸ)
- [x] å¼‚å¸¸å€¼å¤„ç† (å¹´é¾„ã€æ”¶å…¥)
- [x] æ€§åˆ«æ ‡å‡†åŒ– ([ç”·, å¥³])
- [x] æ—¥æœŸéªŒè¯å’Œæå– (å¹´æœˆ)
- [x] ç¼ºå¤±å€¼ç»Ÿè®¡
- [x] å»é‡ (åŸºäº customer_id)

### å®¢æˆ·è¡Œä¸ºèµ„äº§æ¸…æ´—
- [x] æ•°æ®ç±»å‹è½¬æ¢ (åŒç²¾åº¦ã€æ•´æ•°ã€æ—¶é—´æˆ³)
- [x] èµ„äº§æ•°æ®éªŒè¯ (0-1äº¿)
- [x] è¡Œä¸ºæ•°æ®éªŒè¯ (éè´Ÿæ•°)
- [x] äº§å“æ ‡å¿—éªŒè¯ (0 æˆ– 1)
- [x] ç¼ºå¤±å€¼å¤„ç† (contact_result)
- [x] å»é‡ (åŸºäº customer_id + stat_month)

### æ•°æ®è´¨é‡æ£€æŸ¥
- [x] è¾“å…¥/è¾“å‡ºè¡Œæ•°å¯¹æ¯”
- [x] å¼‚å¸¸å€¼ç»Ÿè®¡
- [x] ç¼ºå¤±å€¼ç»Ÿè®¡
- [x] å»é‡è¡Œæ•°ç»Ÿè®¡
- [x] è¯¦ç»†è´¨é‡æŠ¥å‘Š

### æ•°æ®è¾“å‡º
- [x] è¾“å‡º CSV æ–‡ä»¶
- [x] ä¿ç•™è¡¨å¤´ä¿¡æ¯
- [x] UTF-8 ç¼–ç æ”¯æŒ

### ç»Ÿè®¡åˆ†æ (Pandas ç‰ˆæœ¬)
- [x] å¹´é¾„åˆ†å¸ƒåˆ†æ
- [x] æ”¶å…¥åˆ†å¸ƒåˆ†æ
- [x] æ€§åˆ«/å©šå§»/åŸå¸‚åˆ†å¸ƒ
- [x] èµ„äº§åˆ†å¸ƒåˆ†æ
- [x] äº§å“æŒæœ‰æƒ…å†µ
- [x] App ç™»å½•é¢‘ç‡ç»Ÿè®¡

---

## ğŸ”§ æ ¸å¿ƒæ¸…æ´—è§„åˆ™

### å®¢æˆ·åŸºæœ¬ä¿¡æ¯

```
å­—æ®µ             æ¸…æ´—è§„åˆ™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
customer_id      å»ç©ºæ ¼
name             å»ç©ºæ ¼
age              è½¬int, å¼‚å¸¸å€¼(< 18 æˆ– > 100)è®¾ä¸ºç©º
gender           éªŒè¯æ˜¯å¦ä¸º [ç”·, å¥³]
monthly_income   è½¬double, å¼‚å¸¸å€¼(< 0 æˆ– > 100ä¸‡)è®¾ä¸ºç©º
open_account_date è½¬æ—¥æœŸ, æå–å¹´æœˆ
å…¶ä»–å­—ç¬¦å­—æ®µ     å»ç©ºæ ¼
å»é‡è§„åˆ™         åŸºäº customer_id
```

### å®¢æˆ·è¡Œä¸ºèµ„äº§

```
å­—æ®µ                     æ¸…æ´—è§„åˆ™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
total_assets            è½¬double, éªŒè¯0-1äº¿èŒƒå›´
å„ç±»ä½™é¢                è½¬double
å„ç±»æ ‡å¿—                è½¬int, éªŒè¯0æˆ–1
å„ç±»è®¡æ•°                è½¬int
æ—¶é—´æˆ³å­—æ®µ              è½¬timestamp
è´Ÿæ•°å­—æ®µ                è´Ÿæ•°æ”¹ä¸º0
contact_result          æ ‡è®°ç¼ºå¤±å€¼
å»é‡è§„åˆ™                åŸºäº(customer_id, stat_month),
                        ä¿ç•™æœ€æ–°çš„è®°å½•
```

---

## ğŸ“ˆ æœŸæœ›çš„è¾“å‡ºç»“æœ

è¿è¡Œç¬”è®°æœ¬åï¼Œåº”åœ¨ `output/` ç›®å½•ä¸­ç”Ÿæˆï¼š

```
output/
â”œâ”€â”€ cleaned_customer_base.csv       # æ¸…æ´—åçš„å®¢æˆ·åŸºæœ¬ä¿¡æ¯
â”‚   â”œâ”€â”€ è¡Œæ•°: < åŸå§‹è¡Œæ•° (å»é™¤äº†é‡å¤)
â”‚   â””â”€â”€ å­—æ®µ: åŸå§‹å­—æ®µ + gender_flag + open_account_year + open_account_month
â”‚
â””â”€â”€ cleaned_customer_behavior.csv   # æ¸…æ´—åçš„å®¢æˆ·è¡Œä¸ºèµ„äº§
    â”œâ”€â”€ è¡Œæ•°: < åŸå§‹è¡Œæ•° (å»é™¤äº†é‡å¤)
    â””â”€â”€ å­—æ®µ: åŸå§‹å­—æ®µ + total_assets_valid + assets_balance_check + contact_result_flag
```

**è´¨é‡æŠ¥å‘Šç¤ºä¾‹**:
```
ã€å®¢æˆ·åŸºæœ¬ä¿¡æ¯ã€‘
  input_rows: 10000
  output_rows: 9985          # ç§»é™¤äº†15æ¡é‡å¤
  age_invalid_count: 5       # 5æ¡è®°å½•å¹´é¾„å¼‚å¸¸
  income_invalid_count: 3    # 3æ¡è®°å½•æ”¶å…¥å¼‚å¸¸
  gender_invalid_count: 0    # æ€§åˆ«å…¨éƒ¨æœ‰æ•ˆ

ã€å®¢æˆ·è¡Œä¸ºèµ„äº§ã€‘
  input_rows: 15000
  output_rows: 14950         # ç§»é™¤äº†50æ¡é‡å¤
  contact_result_missing: 120  # 120æ¡è®°å½•ç¼ºå¤±
  assets_invalid_count: 2    # 2æ¡è®°å½•èµ„äº§å¼‚å¸¸
```

---

## ğŸš€ ç«‹å³ä½¿ç”¨

### æ–¹å¼ 1: Pandasï¼ˆæ¨èï¼‰

```bash
cd c:\Users\hy120\Downloads\zhihullm\CASE-customer-group

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.venv\Scripts\activate.bat

# å®‰è£…ä¾èµ– (å¦‚æœéœ€è¦)
pip install pandas

# å¯åŠ¨ç¬”è®°æœ¬
jupyter notebook test/pandas/test_pandas_cleansing.ipynb
```

### æ–¹å¼ 2: Spark

```bash
cd c:\Users\hy120\Downloads\zhihullm\CASE-customer-group

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.venv\Scripts\activate.bat

# å®‰è£… Java 11 (å¦‚éœ€)
# https://www.oracle.com/java/technologies/downloads/#java11

# è®¾ç½®ç¯å¢ƒå˜é‡
set JAVA_HOME=C:\Program Files\Java\jdk-11

# å¯åŠ¨ç¬”è®°æœ¬
jupyter notebook test/spark/test_spark_cleansing.ipynb
```

---

## ğŸ“ ç¬”è®°æœ¬ç»“æ„

ä¸¤ä¸ªç¬”è®°æœ¬éƒ½éµå¾ªç›¸åŒçš„ç»“æ„ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤ï¼š

```
1. ç¯å¢ƒé…ç½®
   â””â”€ å¯¼å…¥åº“ã€ä¿®å¤ç¼–ç ã€åˆå§‹åŒ–

2. åŠ è½½æ•°æ®
   â””â”€ è¯»å– CSVã€æ˜¾ç¤ºä¿¡æ¯

3. æ¸…æ´—å®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨
   â”œâ”€ æ•°æ®ç±»å‹è½¬æ¢
   â”œâ”€ å¼‚å¸¸å€¼å¤„ç†
   â”œâ”€ æ•°æ®æ ‡å‡†åŒ–
   â”œâ”€ ç¼ºå¤±å€¼ç»Ÿè®¡
   â””â”€ å»é‡

4. æ¸…æ´—å®¢æˆ·è¡Œä¸ºèµ„äº§è¡¨
   â”œâ”€ æ•°æ®ç±»å‹è½¬æ¢
   â”œâ”€ èµ„äº§æ•°æ®éªŒè¯
   â”œâ”€ è¡Œä¸ºæ•°æ®éªŒè¯
   â”œâ”€ äº§å“æ ‡å¿—éªŒè¯
   â”œâ”€ ç¼ºå¤±å€¼å¤„ç†
   â””â”€ å»é‡

5. æ•°æ®è´¨é‡æ£€æŸ¥æŠ¥å‘Š
   â””â”€ ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

6. è¾“å‡ºæ¸…æ´—åçš„æ•°æ®
   â””â”€ ä¿å­˜ CSV æ–‡ä»¶

7. æ¸…æ´—ç»“æœç»Ÿè®¡
   â””â”€ æ˜¾ç¤ºä¿ç•™ç‡ç­‰ç»Ÿè®¡

8. æ¸…æ´—ç»“æœé¢„è§ˆ
   â””â”€ æ˜¾ç¤ºå‰å‡ è¡Œæ•°æ®

9. æ•°æ®åˆ†æ (Pandas ç‰ˆæœ¬)
   â””â”€ å¯è§†åŒ–åˆ†æç»“æœ
```

---

## ğŸ”— ä¸ AWS Glue è„šæœ¬çš„å¯¹åº”å…³ç³»

ä¸¤ä¸ªç¬”è®°æœ¬å®Œå…¨åŸºäº [glue_scripts/1_data_cleansing.py](glue_scripts/1_data_cleansing.py) å®ç°ï¼š

| Glue è„šæœ¬éƒ¨åˆ† | Pandas ç¬”è®°æœ¬ | Spark ç¬”è®°æœ¬ |
|------|------|------|
| å¯¼å…¥åº“ | ç¬¬1ã€2æ­¥ | ç¬¬1ã€2æ­¥ |
| åŠ è½½æ•°æ® | ç¬¬2æ­¥ | ç¬¬2æ­¥ |
| æ¸…æ´—å®¢æˆ·åŸºæœ¬ä¿¡æ¯ | ç¬¬3æ­¥ | ç¬¬3æ­¥ |
| æ¸…æ´—å®¢æˆ·è¡Œä¸ºèµ„äº§ | ç¬¬4æ­¥ | ç¬¬4æ­¥ |
| æ•°æ®è´¨é‡æ£€æŸ¥ | ç¬¬5æ­¥ | ç¬¬5æ­¥ |
| è¾“å‡ºæ•°æ® | ç¬¬6æ­¥ | ç¬¬6æ­¥ |

---

## ğŸ’¡ å…³é”®ç‰¹æ€§

### 1. è‡ªåŠ¨è·¯å¾„æ£€æµ‹

ä¸¤ä¸ªç¬”è®°æœ¬éƒ½èƒ½è‡ªåŠ¨æ£€æµ‹é¡¹ç›®æ ¹ç›®å½•ï¼š

```python
project_root = Path.cwd()
if project_root.name != "CASE-customer-group":
    project_root = project_root.parent
```

### 2. è¯¦ç»†çš„è¿›åº¦æç¤º

```
âœ“ æ•°æ®åŠ è½½å®Œæˆ
âœ“ æ•°æ®ç±»å‹è½¬æ¢å®Œæˆ
âœ“ å¼‚å¸¸å€¼å¤„ç†å®Œæˆ
âœ“ å»é‡å®Œæˆ
```

### 3. å®Œæ•´çš„è´¨é‡æŠ¥å‘Š

åŒ…å«è¾“å…¥/è¾“å‡ºè¡Œæ•°ã€å¼‚å¸¸å€¼ç»Ÿè®¡ã€ä¿ç•™ç‡ç­‰ä¿¡æ¯ã€‚

### 4. UTF-8 ç¼–ç æ”¯æŒ

æ­£ç¡®å¤„ç†ä¸­æ–‡å­—ç¬¦ï¼Œæ”¯æŒ Windows ç³»ç»Ÿã€‚

---

## âœ¨ åç»­å¯èƒ½çš„æ‰©å±•

### æ·»åŠ çš„åŠŸèƒ½

- [ ] æ•°æ®å¯è§†åŒ–å›¾è¡¨ (Spark ç‰ˆæœ¬)
- [ ] å¼‚å¸¸å€¼æ£€æµ‹å’Œå¤„ç† (æ›´å¤æ‚çš„è§„åˆ™)
- [ ] ç‰¹å¾å·¥ç¨‹ (è¡ç”Ÿå­—æ®µè®¡ç®—)
- [ ] åˆ†ç»„ç»Ÿè®¡ (æŒ‰åŸå¸‚ã€å¹´é¾„æ®µç­‰)
- [ ] å¯¼å‡ºä¸º Excel æ ¼å¼
- [ ] å®æ—¶å¤„ç†æŠ¥å‘Šåˆ° Email

### é›†æˆå»ºè®®

- [ ] ä¸ AWS Glue é›†æˆ
- [ ] ä¸ Airflow DAG é›†æˆ
- [ ] ä¸æ•°æ®ä»“åº“é›†æˆ
- [ ] æ·»åŠ ç›‘æ§å’Œå‘Šè­¦

---

## ğŸ“ è·å–å¸®åŠ©

- **ä½¿ç”¨æŒ‡å—**: [test/NOTEBOOKS_GUIDE.md](test/NOTEBOOKS_GUIDE.md)
- **Pandas æ–‡æ¡£**: https://pandas.pydata.org/
- **PySpark æ–‡æ¡£**: https://spark.apache.org/docs/latest/api/python/
- **Jupyter æ–‡æ¡£**: https://jupyter.org/

---

## âœ… æ£€æŸ¥æ¸…å•

- [x] åˆ›å»º test/pandas/ ç›®å½•
- [x] åˆ›å»º test/spark/ ç›®å½•
- [x] å®ç° Pandas ç‰ˆæœ¬ç¬”è®°æœ¬
- [x] å®ç° Spark ç‰ˆæœ¬ç¬”è®°æœ¬
- [x] åˆ›å»ºä½¿ç”¨æŒ‡å—
- [x] éªŒè¯ç¬”è®°æœ¬æ–‡ä»¶æœ‰æ•ˆæ€§
- [x] æ·»åŠ ä»£ç æ³¨é‡Šå’Œè¯´æ˜

---

## ğŸ‰ å®Œæˆï¼

ä¸¤ä¸ªå®Œæ•´çš„æ•°æ®æ¸…æ´—ç¬”è®°æœ¬å·²å‡†å¤‡å°±ç»ªã€‚

**ç«‹å³å¼€å§‹**:

```bash
jupyter notebook test/pandas/test_pandas_cleansing.ipynb
```

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€

---

*åˆ›å»ºäº: 2025-12-03*
*åŸºäº: glue_scripts/1_data_cleansing.py*
*ç‰ˆæœ¬: 1.0*
