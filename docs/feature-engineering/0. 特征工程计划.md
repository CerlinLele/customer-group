# 特征工程计划

## 一、数据理解与准备

### 1.1 数据探索
- 检查数据质量：缺失值、异常值、重复值
- 分析数据分布：数值特征分布、类别特征频数
- 时间范围分析：`stat_month`的时间跨度，客户记录数量分布
- 关联关系验证：`customer_base`与`customer_behavior_assets`的关联完整性

### 1.2 数据合并策略
- 确定时间窗口：使用最新月份数据作为快照，或使用历史多个月份数据
- 合并方式：左连接`customer_base`和`customer_behavior_assets`（基于`customer_id`）
- 处理一对多关系：一个客户多条月度记录的处理策略

## 二、第一阶段：基础特征工程

### 2.1 客户基础特征（来自customer_base.csv）
- **数值特征**：
  - `age`：直接使用，考虑分箱（年龄段：青年/中年/老年）
  - `monthly_income`：直接使用，考虑对数变换处理偏态
- **类别特征编码**：
  - `gender`：Label Encoding（男/女 → 0/1）
  - `occupation_type`：One-Hot Encoding（5个类别）
  - `lifecycle_stage`：Ordinal Encoding（新客户→成长→成熟→忠诚，体现客户价值）
  - `marriage_status`：Label Encoding
  - `city_level`：Label Encoding（一线/二线）
  - `occupation`：考虑TF-IDF或频率编码（如果类别过多）
- **时间特征提取**（从`open_account_date`）：
  - `account_age_months`：开户至今月数
  - `account_age_years`：开户至今年数
  - `account_season`：开户季节（春夏秋冬）
  - `account_year`：开户年份

### 2.2 资产特征（来自customer_behavior_assets.csv）
- **当前资产特征**（使用最新月份数据）：
  - `total_assets`：总资产（考虑对数变换）
  - `deposit_balance`、`financial_balance`、`fund_balance`、`insurance_balance`：各类产品余额
  - `asset_level`：资产等级（Ordinal Encoding：50万以下→50-80万→80-100万→100万+）
- **资产结构特征**：
  - `deposit_ratio`：存款占比 = deposit_balance / total_assets
  - `financial_ratio`：理财占比
  - `fund_ratio`：基金占比
  - `insurance_ratio`：保险占比
  - `asset_diversification`：资产分散度（持有产品类型数量）

### 2.3 产品持有特征
- `product_count`：持有产品总数
- `deposit_flag`、`financial_flag`、`fund_flag`、`insurance_flag`：产品持有标志
- `has_multiple_products`：是否持有多种产品（布尔特征）

## 三、第二阶段：时间序列与聚合特征

### 3.1 历史行为聚合特征（基于customer_behavior_assets历史数据）
- **资产趋势特征**（最近3/6/12个月）：
  - `assets_growth_rate_3m`：3个月资产增长率
  - `assets_growth_rate_6m`：6个月资产增长率
  - `assets_avg_3m`：3个月平均资产
  - `assets_std_3m`：3个月资产标准差（波动性）
  - `assets_max_3m`、`assets_min_3m`：资产极值
- **行为活跃度特征**：
  - `avg_login_count_3m`：平均登录次数
  - `avg_investment_count_3m`：平均投资次数
  - `total_repurchase_count_6m`：6个月累计复购次数
  - `avg_financial_view_time_3m`：平均理财页面浏览时长
  - `avg_product_compare_count_3m`：平均产品对比次数
- **消费行为特征**：
  - `avg_credit_card_expense_3m`：平均信用卡消费
  - `credit_card_expense_trend`：消费趋势（上升/下降/稳定）

### 3.2 时间间隔特征
- `days_since_last_login`：距离最后登录天数（从`last_app_login_time`计算）
- `days_since_last_contact`：距离最后营销联系天数
- `days_in_cool_period`：营销冷静期剩余天数（如果仍在冷静期内）
- `login_frequency`：登录频率（总登录次数/账户月数）

### 3.3 营销互动特征
- `contact_result_encoded`：联系结果编码（成功/考虑中/未接通/拒绝）
- `has_been_contacted`：是否曾被联系过
- `contact_success_rate`：历史联系成功率
- `is_in_cool_period`：是否在营销冷静期（布尔特征）

## 四、第三阶段：高级特征与交叉特征

### 4.1 业务交叉特征
- **收入-资产比**：
  - `assets_to_income_ratio`：总资产/月收入（资产积累能力）
  - `expense_to_income_ratio`：信用卡消费/月收入（消费能力）
- **生命周期-资产特征**：
  - `lifecycle_asset_match`：生命周期阶段与资产水平的匹配度
- **职业-资产特征**：
  - `occupation_income_match`：职业类型与收入水平的匹配度
- **年龄-产品偏好**：
  - `age_product_preference`：不同年龄段的产品持有模式

### 4.2 行为模式特征
- `high_value_behavior`：高价值行为综合指标（结合资产、活跃度、产品持有）
- `engagement_score`：客户 engagement 评分（APP使用+投资行为）
- `loyalty_score`：忠诚度评分（复购次数+持有时长+产品数量）

### 4.3 风险与稳定性特征
- `asset_volatility`：资产波动性（标准差/均值）
- `behavior_consistency`：行为一致性（登录、投资等行为的稳定性）
- `churn_risk_indicators`：流失风险指标（登录频率下降、资产减少等）

## 五、特征处理与优化

### 5.1 特征变换
- **数值特征标准化**：StandardScaler或MinMaxScaler
- **偏态分布处理**：对数变换（log1p）处理资产、收入等
- **异常值处理**：IQR方法或3-sigma规则

### 5.2 特征选择
- **相关性分析**：去除高度相关的特征
- **重要性分析**：使用树模型（RandomForest/XGBoost）评估特征重要性
- **SHAP值分析**：识别对高潜力客户预测最关键的因子

### 5.3 缺失值处理
- 数值特征：中位数填充或0填充（根据业务含义）
- 类别特征：单独类别"未知"或众数填充
- 时间特征：基于业务逻辑填充（如从未登录则设为最大值）

## 六、特征存储与管理

### 6.1 特征版本管理
- 创建特征工程脚本：`feature_engineering.py`
- 特征定义文档：记录每个特征的业务含义和计算方法
- 特征版本控制：不同阶段的特征集保存为不同版本

### 6.2 特征输出
- 生成特征矩阵：保存为CSV或Parquet格式
- 特征元数据：记录特征名称、类型、来源表、计算逻辑

## 七、实施优先级

### Phase 1（立即实施）
- 客户基础特征（2.1）
- 当前资产特征（2.2）
- 产品持有特征（2.3）

### Phase 2（第一周）
- 时间序列聚合特征（3.1基础部分）
- 时间间隔特征（3.2）
- 营销互动特征（3.3）

### Phase 3（第二周）
- 完整的聚合特征（3.1全部）
- 业务交叉特征（4.1）
- 行为模式特征（4.2）

### Phase 4（优化阶段）
- 风险与稳定性特征（4.3）
- 特征选择与优化（5.2）
- SHAP分析集成

## 八、验证与评估

### 8.1 特征质量检查
- 特征分布合理性
- 特征与目标变量的相关性
- 特征稳定性（时间窗口变化时的稳定性）

### 8.2 模型验证
- 使用基础特征集训练初始模型（基准）
- 逐步添加特征，评估模型性能提升（AUC目标≥0.85）
- 特征重要性排序，识别关键因子

## 关键文件

- `feature_engineering.py`：主特征工程脚本
- `feature_config.yaml`：特征配置（定义哪些特征需要生成）
- `docs/feature-engineering/feature_dictionary.md`：特征字典文档
- `data/processed/features_v1.csv`：生成的特征数据集

